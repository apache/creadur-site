<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/development/ui/generator.md at 2024-10-22

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Apache Rat&trade; &#x2013; The Generator</title>
    <link rel="stylesheet" href="../../css/maven-base.css" />
    <link rel="stylesheet" href="../../css/maven-theme.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />
<link href="https://creadur.apache.org/font/matesc.css" type="text/css" rel="stylesheet" />
  </head>
  <body class="composite">
    <div id="banner">
<a href="https://www.apache.org/" id="bannerLeft"><img src="https://www.apache.org/img/asf_logo.png"  alt="The Apache Software Foundation" title="The Apache Software Foundation"/></a>      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2024-10-22</span>
           | <span id="projectVersion">Version: 0.17-SNAPSHOT</span>
          | <a href="https://www.apache.org/" class="externalLink" title="Apache">Apache</a> &gt;
<a href="https://creadur.apache.org/" class="externalLink" title="Creadur">Creadur</a> &gt;
<a href="https://creadur.apache.org/rat/" class="externalLink" title="Rat">Rat</a> &gt;
The Generator
      </div>
      <div class="xright">      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Apache Rat™</h5>
    <ul>
     <li class="none"><a href="../../index.html" title="Introducing Rat">Introducing Rat</a></li>
     <li class="none"><a href="../../download_rat.cgi" title="Downloads">Downloads</a></li>
     <li class="none"><a href="../../RELEASE_NOTES.txt" title="Changes">Changes</a></li>
    </ul>
       <h5>Rat from the Command Line</h5>
    <ul>
     <li class="none"><a href="../../apache-rat/index.html" title="Command Line Introduction">Command Line Introduction</a></li>
     <li class="none"><a href="../../apache-rat-core/exclusion_expression.html" title="Exclusion Expressions">Exclusion Expressions</a></li>
    </ul>
       <h5>Rat from Ant</h5>
    <ul>
     <li class="none"><a href="../../apache-rat-tasks/index.html" title="Ant Task Introduction">Ant Task Introduction</a></li>
    </ul>
       <h5>Rat from Maven</h5>
    <ul>
     <li class="none"><a href="../../apache-rat-plugin/index.html" title="Maven Plugin Introduction">Maven Plugin Introduction</a></li>
    </ul>
       <h5>Configuring Rat</h5>
    <ul>
     <li class="none"><a href="../../license_def.html" title="Defining New Licenses">Defining New Licenses</a></li>
     <li class="none"><a href="../../apache-rat/name_xref.html" title="Option Name Cross Reference">Option Name Cross Reference</a></li>
     <li class="none"><a href="../../apache-rat/default_licenses.html" title="Default Licenses, etc">Default Licenses, etc</a></li>
     <li class="none"><a href="../../apache-rat/xsd.html" title="Configuration XSD">Configuration XSD</a></li>
     <li class="none"><a href="https://gitbox.apache.org/repos/asf/creadur-rat/blob/master/apache-rat-core/src/main/resources/org/apache/rat/default.xml" class="externalLink" title="Default Configuration">Default Configuration</a></li>
    </ul>
       <h5>Rat Output</h5>
    <ul>
     <li class="none"><a href="../../apache-rat/output/example.html" title="Standard Output Example">Standard Output Example</a></li>
     <li class="none"><a href="https://gitbox.apache.org/repos/asf/creadur-rat/blob/master/apache-rat-core/src/main/resources/org/apache/rat/rat-report.xsd" class="externalLink" title="Output XSD">Output XSD</a></li>
     <li class="none"><a href="https://gitbox.apache.org/repos/asf/creadur-rat/blob/master/apache-rat-core/src/main/resources/org/apache/rat/plain-rat.xsl" class="externalLink" title="XSLT - Plain text">XSLT - Plain text</a></li>
     <li class="none"><a href="https://gitbox.apache.org/repos/asf/creadur-rat/blob/master/apache-rat-core/src/main/resources/org/apache/rat/missing-headers.xsl" class="externalLink" title="XSLT - Missing headers list">XSLT - Missing headers list</a></li>
     <li class="none"><a href="https://gitbox.apache.org/repos/asf/creadur-rat/blob/master/apache-rat-core/src/main/resources/org/apache/rat/unapproved-licenses.xsl" class="externalLink" title="XSLT - Unapproved licenses list">XSLT - Unapproved licenses list</a></li>
    </ul>
       <h5>Developing Rat</h5>
    <ul>
     <li class="none"><a href="../../architecture.html" title="Architecture">Architecture</a></li>
     <li class="none"><a href="../../apidocs/index.html" title="Javadocs">Javadocs</a></li>
     <li class="none"><a href="../../apache-rat-core/development/document_name.html" title="Document Name concept">Document Name concept</a></li>
     <li class="none"><a href="../../development/ui_implementation.html" title="UI Development">UI Development</a></li>
     <li class="none"><a href="../../apache-rat-core/development/write_file_processor.html" title="Writing a File Processor">Writing a File Processor</a></li>
    </ul>
       <h5>Apache Creadur™</h5>
    <ul>
     <li class="none"><a href="https://creadur.apache.org" class="externalLink" title="Creadur Project Home">Creadur Project Home</a></li>
     <li class="none"><a href="https://creadur.apache.org/tentacles" class="externalLink" title="Apache Tentacles">Apache Tentacles</a></li>
     <li class="none"><a href="https://creadur.apache.org/whisker" class="externalLink" title="Apache Whisker">Apache Whisker</a></li>
     <li class="none"><a href="https://www.apache.org/security/" class="externalLink" title="Security">Security</a></li>
     <li class="none"><a href="https://www.apache.org/licenses/" class="externalLink" title="License">License</a></li>
     <li class="none"><a href="https://privacy.apache.org/policies/privacy-policy-public.html" class="externalLink" title="Privacy">Privacy</a></li>
     <li class="none"><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship">Sponsorship</a></li>
     <li class="none"><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">Thanks</a></li>
    </ul>
       <h5>The Apache Software Foundation</h5>
    <ul>
     <li class="none"><a href="https://www.apache.org/foundation" class="externalLink" title="About the Foundation">About the Foundation</a></li>
     <li class="none"><a href="https://projects.apache.org" class="externalLink" title="The projects">The projects</a></li>
     <li class="none"><a href="https://people.apache.org" class="externalLink" title="The people">The people</a></li>
     <li class="none"><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How we work">How we work</a></li>
     <li class="none"><a href="https://www.apache.org/foundation/how-it-works.html#history" class="externalLink" title="Our history">Our history</a></li>
     <li class="none"><a href="https://blogs.apache.org/foundation/" class="externalLink" title="News">News</a></li>
    </ul>
       <h5>Contribute</h5>
    <ul>
     <li class="none"><a href="https://www.apache.org/foundation/getinvolved.html" class="externalLink" title="Get Involved">Get Involved</a></li>
    </ul>
       <h5>Committer Info</h5>
    <ul>
     <li class="none"><a href="https://www.apache.org/dev/committers.html" class="externalLink" title="ASF Committers' FAQ">ASF Committers' FAQ</a></li>
     <li class="none"><a href="https://www.apache.org/dev/new-committers-guide.html" class="externalLink" title="New Committers Guide">New Committers Guide</a></li>
     <li class="none"><a href="../../site-publish.html" title="Howto publish this site">Howto publish this site</a></li>
     <li class="none"><a href="https://community.apache.org/" class="externalLink" title="Community">Community</a></li>
     <li class="none"><a href="https://www.apache.org/legal/" class="externalLink" title="Legal">Legal</a></li>
     <li class="none"><a href="https://www.apache.org/foundation/marks/" class="externalLink" title="Branding">Branding</a></li>
     <li class="none"><a href="https://www.apache.org/press/" class="externalLink" title="Media Relations">Media Relations</a></li>
    </ul>
       <h5>Modules</h5>
    <ul>
     <li class="none"><a href="../../apache-rat-core/index.html" title="Apache Creadur Rat::Core">Apache Creadur Rat::Core</a></li>
     <li class="none"><a href="../../apache-rat-plugin/index.html" title="Apache Creadur Rat::Plugin4Maven">Apache Creadur Rat::Plugin4Maven</a></li>
     <li class="none"><a href="../../apache-rat-tasks/index.html" title="Apache Creadur Rat::Tasks4Ant">Apache Creadur Rat::Tasks4Ant</a></li>
     <li class="none"><a href="../../apache-rat/index.html" title="Apache Creadur Rat::Packaging">Apache Creadur Rat::Packaging</a></li>
     <li class="none"><a href="../../apache-rat-tools/index.html" title="Apache Creadur Rat::Tools">Apache Creadur Rat::Tools</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="../../project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="../../project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
      <a href="https://maven.apache.org/" title="Maven" class="poweredBy">
        <img class="poweredBy"  alt="Maven" src="https://maven.apache.org/images/logos/maven-feather.png"     />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<!---
 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.
 The ASF licenses this file to You under the Apache License, Version 2.0
 (the "License"); you may not use this file except in compliance with
 the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
<h1>The Generator</h1>
<blockquote>

<ul>

<li>
<blockquote>

<p>Up: <a href="../ui_implementation.html">UI Implementation</a>
<br /><a href="./options.html">Options</a> | Generator | <a href="./ui_specific.html">UI Specific</a></p>
</blockquote>
</li>
</ul>
</blockquote>
<p>The generator is the bit of code that ties the new UI to the Rat CLI. In this section we will explore how the Rat core module exposes the information necessary to build a valuable new UI.  We will be using the Maven tooling code in <code>apache-rat-tools</code> as the basis of the examples in this section.  As always, the current code base is the source of truth.</p>
<p>There are two implementations of the Generator concept <code>AntGenerator</code> and <code>MavenGenerator</code>.</p><section>
<h2><a name="The_MavenGenerator"></a>The MavenGenerator</h2>
<p>The <code>MavenGenerator</code> generates the abstract class that is used by the <code>apache-rat-plugin</code> module to process Maven elements that are tied to the CLI options.  The class starts with a list map of exceptional CLI Option name to Maven option name conversions.  In the code below the legacy &#x201c;addLicense&#x201d; option is changed to &#x201c;add-license&#x201d; so that the standard conversion to camel case will produce the proper name.  There is also a list of options that are not supported by Maven.  In code below the &#x201c;&#x2013;dir&#x201d;. &#x201c;&#x2013;log-level&#x201d;, and &#x201c;&#x2013;help&#x201d; options are all excluded.  &#x201c;&#x2013;dir&#x201d; is excluded because Maven produces a list of files to process, &#x201c;&#x2013;log-level&#x201d; is excluded because the Maven log level is set via a different process, and &#x201c;&#x2013;help&#x201d; is excluded because Maven has it own help facility.</p>

<div class="source">
<pre><code class="language-java">    /** A mapping of external name to internal name if not standard */
    private static final Map&lt;String, String&gt; RENAME_MAP = new HashMap&lt;&gt;();

    /** List of CLI Options that are not supported by Maven. */
    private static final List&lt;Option&gt; MAVEN_FILTER_LIST = new ArrayList&lt;&gt;();

    static {
        RENAME_MAP.put(&quot;addLicense&quot;, &quot;add-license&quot;);

        MAVEN_FILTER_LIST.addAll(Arg.DIR.group().getOptions());
        MAVEN_FILTER_LIST.addAll(Arg.LOG_LEVEL.group().getOptions());
        MAVEN_FILTER_LIST.add(OptionCollection.HELP);
    }

    /**
     * Filter to remove Options not supported by Maven.
     */
    private static final Predicate&lt;Option&gt; MAVEN_FILTER = option -&gt; !(MAVEN_FILTER_LIST.contains(option) || option.getLongOpt() == null);

</code></pre></div>
<p>The list of MavenOptions (see <a href="./options.html">Options</a>) can then be generated by</p>

<div class="source">
<pre><code class="language-java">List&lt;MavenOption&gt; options = OptionCollection.buildOptions().getOptions()
        .stream().filter(MAVEN_FILTER)
        .map(MavenOption::new).collect(Collectors.toList());
</code></pre></div>
<p>The <code>MavenGenerator</code> uses a template called &#x201c;Maven.tpl&#x201d; that looks like:</p>

<div class="source">
<pre><code class="language-java">/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

${package}

import org.apache.commons.cli.Option;
import org.apache.commons.lang.StringUtils;
import org.apache.maven.plugin.AbstractMojo;
import org.apache.maven.plugins.annotations.Parameter;
import org.apache.rat.commandline.Arg;
import org.apache.rat.utils.CasedString;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.stream.Collectors;

/* DO NOT EDIT - GENERATED FILE */

/**
 * Generated class to provide Maven support for standard Rat command line options
 */
${class}

    private final static Map&lt;String,String&gt; xlateName = new HashMap&lt;&gt;();

    private final static List&lt;String&gt; unsupportedArgs = new ArrayList&lt;&gt;();

    static {
${static}
    }

    public static String createName(String longOpt) {
        String name = xlateName.get(longOpt);
        return name != null ? name : new CasedString(CasedString.StringCase.KEBAB, longOpt).toCase(CasedString.StringCase.CAMEL);
    }

    public static List&lt;String&gt; unsupportedArgs() {
        return Collections.unmodifiableList(unsupportedArgs);
    }

${commonArgs}

${constructor}


    /*  GENERATED METHODS */


${methods}
}

</code></pre></div>
<p>this template contains replaceable sections for :</p>
<ul>

<li>package: The name of the java package that the generated class belongs to.</li>
<li>class: The line that defines the class for the Maven generated code it reads: <code>public abstract class BaseRatMojo extends AbstractMojo {</code>.  Note that the Maven example extends a Maven package class.</li>
<li>static: A section to initialize the static data like the translation name table and the unsupportedArgs list.</li>
<li>commonArgs: A section where the &#x201c;Args.tpl&#x201d; is inserted.  This section contains the methods for argument manipulation that is common among all the UIs</li>
<li>constructor: The constructor for the class.  In the Maven case this is simply <code>protected BaseRatMojo() {}</code>.</li>
<li>methods: A section where the generator will insert the methods that map from the Maven framework into the Rat framework as specified in the &#x201c;Args.tpl&#x201d;.</li>
</ul></section><section>
<h2><a name="The_Args_template"></a>The Args template</h2>
<p>The args template defines a number of methods to simplify the interface between an arbitrary UI and the Rat CLI command line format.  The template defines a variable called <code>args</code> that is a map of a CLI based argument name to a list of Strings that are the argument values.</p>
<p>In general classes that include this template will call:
<code>setArg</code>, <code>addArg</code>, and/or <code>removeArg</code> to set values in the args structure.  Eventually the UI class will call <code>getArgs</code> to generate a command line string to pass to the CLI command line parsing code to create a <code>ReportConfiguration</code> that may be modified before calling <code>Reporter.report()</code></p>

<div class="source">
<pre><code class="language-java">    ///////////////////////// Start common Arg manipulation code

    /**
     * A map of CLI based arguments to values.
     */
    protected final Map&lt;String, List&lt;String&gt;&gt; args = new HashMap&lt;&gt;();

    /**
     * Gets the list of arguments prepared for the CLI code to parse.
     * @return the List of arguments for the CLI command line.
     */
    protected List&lt;String&gt; args() {
        List&lt;String&gt; result = new ArrayList&lt;&gt;();
        for (Map.Entry&lt;String, List&lt;String&gt;&gt; entry : args.entrySet()) {
            result.add(&quot;--&quot; + entry.getKey());
            result.addAll(entry.getValue().stream().filter(Objects::nonNull).collect(Collectors.toList()));
        }
        return result;
    }

    private String argsKey(Option opt) {
        return StringUtils.defaultIfEmpty(opt.getLongOpt(), opt.getKey());
    }

    private boolean validateSet(String key) {
        Arg arg = Arg.findArg(key);
        if (arg != null) {
            Option opt = arg.find(key);
            Option main = arg.option();
            if (opt.isDeprecated()) {
                args.remove(argsKey(main));
                // deprecated options must be explicitly set so let it go.
                return true;
            }
            // non-deprecated options may have default so ignore it if another option has already been set.
            for (Option o : arg.group().getOptions()) {
                if (!o.equals(main)) {
                    if (args.containsKey(argsKey(o))) {
                        return false;
                    }
                }
            }
            return true;
        }
        return false;
    }

    /**
     * Set a key and value into the argument list.
     * Replaces any existing value.
     * @param key the key for the map.
     * @param value the value to set.
     */
    protected void setArg(String key, String value) {
        if (validateSet(key)) {
            List&lt;String&gt; values = new ArrayList&lt;&gt;();
            values.add(value);
            args.put(key, values);
        }
    }

    /**
     * Get the list of values for a key.
     * @param key the key for the map.
     * @return the list of values for the key or {@code null} if not set.
     */
    public List&lt;String&gt; getArg(String key) {
        return args.get(key);
    }

    /**
     * Add values to the key in the argument list.
     * If the key does not exist, adds it.
     * @param key the key for the map.
     * @param value the value to set.
     */
    protected void addArg(String key, String[] value) {
        if (validateSet(key)) {
            List&lt;String&gt; values = args.get(key);
            if (values == null) {
                values = new ArrayList&lt;&gt;();
                args.put(key, values);
            }
            values.addAll(Arrays.asList(value));
        }
    }

    /**
     * Add a value to the key in the argument list.
     * If the key does not exist, adds it.
     * @param key the key for the map.
     * @param value the value to set.
     */
    protected void addArg(String key, String value) {
        if (validateSet(key)) {
            List&lt;String&gt; values = args.get(key);
            if (values == null) {
                values = new ArrayList&lt;&gt;();
                args.put(key, values);
            }
            values.add(value);
        }
    }

    /**
     * Remove a key from the argument list.
     * @param key the key to remove from the map.
     */
    protected void removeArg(String key) {
        args.remove(key);
    }

 ///////////////////////// End common Arg manipulation code

</code></pre></div></section><section>
<h2><a name="Generating_Methods"></a>Generating Methods</h2>
<p>For every <code>MavenOption</code> at least one method is created.</p><section>
<h3><a name="Generating_the_method_signature"></a>Generating the method signature</h3>
<p>The <code>MavenGenerator</code> needs to generate method signatures based on the <code>org.apache.commons.cli.Option</code> state so the <code>MavenOption</code> provides the <code>getMethodSignature</code> method.  This method checks the following conditions.</p>
<ol style="list-style-type: decimal">

<li>Is the option deprecated? If so add the <code>@Deprecated</code> annotation.</li>
<li>Does the option accept one or more arguments (i.e. is not a flag option)? If it does the argument should be a <code>String</code> otherwise it should be a <code>boolean</code>.</li>
<li>Does the method accept multiple arguments?  If so modify the name to indicate plural as per the Maven standard.</li>
<li>Create the Maven <code>@Property</code> annotation with optional Maven command line property and defaults for the method.</li>
<li>Write all the information into a string and prefix the method name with &#x201c;set&#x201d; as per the Maven standard.</li>
</ol>
<p>With the result being that a fully formed, Maven compliant, Java method signature is developed.  Complete with documentation from the Option description.  For example &#x201c;&#x2013;copyright&#x201d;, which is a deprecated option, produces the following Maven mojo method signature:</p>

<div class="source">
<pre><code class="language-java">/**
     * The copyright message to use in the license headers.
     * @param copyright  copyright message to use in the license headers.
     * @deprecated Deprecated for removal since 0.17: Use &amp;lt;editCopyright&amp;gt; instead.
     */
    @Deprecated
    @Parameter(property = &quot;rat.Copyright&quot;)
    public void setCopyright(String copyright) {
</code></pre></div></section><section>
<h3><a name="Generating_the_method_body"></a>Generating the method body</h3>
<p>When executing the generated class should take the value passed in from the new UI convert it to a <code>String</code> (or <code>boolean</code> if a flag option) and call the <code>setArg</code> (or possibly the <code>removeArg</code>) method defined in <code>Args.tpl</code>.  The key for the arg method is the CLI option name (without leading dashes). In the case of the <code>setCopyright</code> method above this looks like:</p>

<div class="source">
<pre><code class="language-java">public void setCopyright(String copyright) {
        setArg(&quot;copyright&quot;, copyright);
    }
</code></pre></div>
<p>Maven also supports the case where multiple values are accepted for one Property.  To support this the <code>MavenGenerator</code> will generate methods that accept multiple String arguments and have a name that pluralizes the standard &#x201c;set&#x201d; based name. Details are available in the <code>MavenGenerator</code> code.</p></section></section><section>
<h2><a name="AntGenerator"></a>AntGenerator</h2>
<p>The AntGenerator follows the same design as the MavenGenerator. The main difference is that Ant allows attributes in the XML elements.</p>
<blockquote>

<ul>

<li>
<blockquote>

<p>Up: <a href="../ui_implementation.html">UI Implementation</a>
&gt; <br /><a href="./options.html">Options</a> | Generator | <a href="./ui_specific.html">UI Specific</a></p>
</blockquote>
</li>
</ul>
</blockquote></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &copy; 2016-2024 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.
      Apache Creadur, Creadur, Apache Rat, Apache Tentacles, Apache Whisker, Apache and the Apache feather logo are trademarks
      of The Apache Software Foundation.
      Oracle and Java are registered trademarks of Oracle and/or its affiliates.
      All other marks mentioned may be trademarks or registered trademarks of their respective owners.
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
